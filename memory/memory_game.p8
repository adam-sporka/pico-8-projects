pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
screen=1
pace=15
gap=5

function _init()
	poke(0x5f2c,3)
	cls()
end

labels={"‚¨ÖÔ∏è","‚û°Ô∏è","‚¨ÜÔ∏è","‚¨áÔ∏è"}
sequence={}

since_preview=0
preview_pos=0

since_input=0
last_input=0
input_pos=0

function reset_sequence()
 state=1
 sequence={}
end

function add_item()
	item=flr(rnd(4))+1
 sequence[#sequence+1]=item
end

function start_game()
	reset_sequence()
	add_item()
	add_item()
	add_item()
	screen=2
	input_pos=1
	preview_pos=1
end

function process_screen_menu()
	if btnp(4) then
		start_game()
	end
end

function process_screen_preview()
 if btnp(5) then
 	preview_pos+=1
 	since_preview=0
 end
end

function process_screen_input()
 input=0
 if (btnp(0)) input=1
 if (btnp(1)) input=2
 if (btnp(2)) input=3
 if (btnp(3)) input=4
 if input>0 and input_pos<#sequence then
  since_input=0
  input_pos+=1
  last_input=input
  if input_pos<=#sequence then
  	if last_input~=sequence[input_pos] then
  		screen=4
  	end
  end
 end
end

function process_screen_game_over()
	if btnp(4) then
		screen=1
	end
end

function _update()
 if screen==1 then
 	process_screen_menu()
 end
 if screen==2 then
 	process_screen_preview()
 end
 if screen==3 then
  process_screen_input()
 end
 if screen==4 then
 	process_screen_game_over()
 end
end

-->8
function print_str(s,color,y)
 x=(64-#s*4)/2
 y=y or 27
 print(s,x,y,color)
end

function screen_menu()
	cls()
	print_str("the memory game", 7, 23)
	print_str("by a.j.", 5, 29)
	print_str("üÖæÔ∏è to start ", 5, 40)
end

function show_label(l)
 todo={{21,28,1},{35,28,2},{28,21,3},{28,35,4}}
 for t=1,#todo do
  x=todo[t][1]
  y=todo[t][2]
  ll=todo[t][3]
  if ll~=l then ll+=16 end
  spr(ll,x,y)
 end
end

function screen_preview()
 cls()
 if preview_pos>0 and preview_pos<=#sequence then
 	if since_preview<pace-gap then
 		show_label(sequence[preview_pos],7)
 		if since_preview==0 then
    sfx(sequence[preview_pos])
 		end
 		since_preview+=1
 	elseif since_preview<pace then
 		show_label(0,7)
 		since_preview+=1
 	elseif since_preview==pace then
 		show_label(0,7)
 		preview_pos+=1
 		since_preview=0
 		since_input=-1
 	end
 else
 	screen=3
 	input_pos=0
 end
end

function screen_input()
 cls()	
 if since_input<0 then
  show_label(0)
 elseif since_input<pace-gap then
 	show_label(last_input)
 	since_input+=1
 else
 	if input_pos==#sequence then
 	 print_str(tostr(#sequence+1),7)
 		if since_input>2*pace then
  		add_item()
 			screen=2
    since_preview=0
    preview_pos=1
 		end
 	else
  	show_label(0)
 	end
 	since_input+=1
 end
 if since_input==1 then
  sfx(last_input)
 end
end

function screen_game_over()
 cls()
 print_str("fail at "..#sequence,15)
	print_str("press üÖæÔ∏è ", 5, 59)
end

function _draw()
 if (screen==1) screen_menu()
 if (screen==2) screen_preview()
 if (screen==3) screen_input()
 if (screen==4) screen_game_over()
end

__gfx__
000000000009000000080000000c000000bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009900000008800000ccc00000bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070009999990888888000ccccc0000bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770009999999088888880ccccccc0bbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000099999908888880000ccc0000bbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700009900000008800000ccc00000bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000900000008000000ccc000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000500000005000000050000005550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000005500000005500000505000005050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000050555505555050005000500005050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000500000505000005055505550555055500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000050555505555050000505000050005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000005500000005500000505000005050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000500000005000000555000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000cc0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000cc0000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000cccccc00000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000cccccc00000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000cccccccccc000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000cccccccccc000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000cccccccccccccc0000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000cccccccccccccc0000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000cccccc00000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000cccccc00000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000cccccc00000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000cccccc00000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000cccccc00000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000cccccc00000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000055000000000000000000000000005500000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000055000000000000000000000000005500000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000005555000000000000000000000000005555000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000005555000000000000000000000000005555000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000550055555555000000000000005555555500550000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000550055555555000000000000005555555500550000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000055000000000055000000000000005500000000005500000000000000000000000000000000000000000000
00000000000000000000000000000000000000000055000000000055000000000000005500000000005500000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000550055555555000000000000005555555500550000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000550055555555000000000000005555555500550000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000005555000000000000000000000000005555000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000005555000000000000000000000000005555000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000055000000000000000000000000005500000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000055000000000000000000000000005500000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000055555500000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000055555500000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000055005500000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000055005500000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000055005500000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000055005500000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000555555005555550000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000555555005555550000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000005500000055000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000005500000055000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000055005500000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000055005500000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000550000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000550000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__sfx__
000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000c0500c0400c0300c0200c0100e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010000010050100401003010020100100e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010000012050120401203012020120100e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000000b0500b0400b0300b0200b0100e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
