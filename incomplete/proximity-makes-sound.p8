pico-8 cartridge // http://www.pico-8.com
version 20
__lua__
discs={}
function new_disc(x,y,r,a,w)
	d={}
	d.x,d.y,d.r,d.a,d.w=x,y,r,a,w
	add(discs,d)
	return #discs
end

links={}
function new_link(i1,i2)
	l={}
	l.i1,l.i2=i1,i2
	l.f,l.e,l.d,l.t=999,999,999,false
	add(links,l)
end

function _init()
	a=new_disc(64,32,32,0,1)
	b=new_disc(64,64,8,0,2)
	c=new_disc(64,96,48,0,.5)
	d=new_disc(64,32,64,0,.25)
	new_link(a,b)
 new_link(b,c)
 new_link(a,d)
end

function get_disc_pos(i)
	return discs[i].x,discs[i].y,discs[i].r
end

function get_point_pos_now(i)
	x=discs[i].x+sin(discs[i].a/64)*discs[i].r
	y=discs[i].y+cos(discs[i].a/64)*discs[i].r
	return x,y
end

function get_point_pos_next(i)
	x=discs[i].x+sin((discs[i].a+discs[i].w)/64)*discs[i].r
	y=discs[i].y+cos((discs[i].a+discs[i].w)/64)*discs[i].r
	return x,y
end

function _draw()
	cls()
	for i=1,#discs do
		x,y,r=get_disc_pos(i)
	 circ(x,y,r)
		x,y=get_point_pos_now(i)
		circ(x,y,2)
	end
	for i=1,#links do
		if links[i].t>0 then
			x1,y1=get_point_pos_now(links[i].i1)
			x2,y2=get_point_pos_now(links[i].i2)
			line(x1,y1,x2,y2)
			sfx(links[i].t)
		end
	end
end

function move()
	for i=1,#discs do
		discs[i].a+=discs[i].w
	end
end

function dists()
	for i=1,#links do
		links[i].f=links[i].e
		links[i].e=links[i].d
		x1,y1=get_point_pos_next(links[i].i1)
		x2,y2=get_point_pos_next(links[i].i2)
		d1=abs(x2-x1)
		d2=abs(y2-y1)
		d=d1*d1+d2*d2
		links[i].d=d
		f=links[i].f
		e=links[i].e
		d=links[i].d
		links[i].t=0
		if f>e and e<d then
			links[i].t=1
		elseif f<e and e>d then
			links[i].t=2
		end
	end
end

function _update()
	move()
	dists()
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000100003705037050370500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000100003205032050320500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344
00 41414344

