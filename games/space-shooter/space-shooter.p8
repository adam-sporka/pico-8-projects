pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
----------------
s={}
ph=0
px=64
py=120
game=0
f=0
best=999
stopped=0
----------------
function kill_all()
	s={}
end
----------------
function spawn(_x,_y,_t)
	add(s,{x=_x,y=_y,t=_t,p=ph,f=32+rnd(32),vx=0,vy=0})
	ph+=0.2
end
----------------
function start_new_game()
	kill_all()
	for x=32,100,4 do
		spawn(x,20,0)
	end
	px=64
	py=120
	game=1
	f=0
end
----------------
function win_game()
	game=2
	stopped=f
	if (stopped<best) best=stopped
end
----------------
function check_win_condition()
	for t in all(s) do
		if t.t==0 then
			return false
		end
	end
	return true
end
----------------
function detect_collisions(t)
	for b in all(s) do
		if b.t==2 then
			rx=flr(b.x-t.x)
			ry=flr(b.y-t.y)
			if rx<-8 or ry<-4 or rx>7 or ry>3 then
			else
				del(s,b)
				return true
			end
		end
	end
	return false
end
----------------
function detect_player_collisions()
 for b in all(s) do
 	if b.t==1 then
   rx=flr(b.x-px)
   ry=flr(b.y-py)
   if rx<-4 or ry<-4 or rx>3 or ry>3 then
   else
    return true
   end 		
 	end
 end
 return false
end
----------------
function update_all()
	for t in all(s) do
		keep=update(t)
		if (keep!=true) del(s,t)
	end
end
----------------
function update_player()
	if (btn(0)) px-=1
	if (btn(1)) px+=1
	if (btn(2)) py-=1
	if (btn(3)) py+=1
	px=px%128
	py=py%128
	if (btnp(4)) spawn(px,py,2)
	if detect_player_collisions() then
		game=3
	end
end
----------------
function update(t)
	if t.t==0 then
		if detect_collisions(t) then
		 return false
		else
		 t.p=(t.p+1/t.f)%1
		 t.vx=cos(t.p)+rnd(0.05)-0.02
		 t.vy=sin(t.p)
		 t.x+=t.vx
		 t.y+=t.vy
		 if t.p<1/t.f then
		 	spawn(t.x,t.y,1)
		 end
 		return true
 	end
	elseif t.t==1 then
		t.y+=2
		if (t.y>130) return false
		return true
	elseif t.t==2 then
		t.y-=2
		if (t.y<0) return false
		return true
	end
	return false
end
----------------
function _update()
	if game==0 then
		if btnp(5) then
			start_new_game()
		end
	elseif game==1 then
		f+=1
		update_player()
		update_all()
		if check_win_condition() then
			win_game()
		end
	elseif game==2 then
		if btnp(5) then
			game=0
		end
	elseif game==3 then
		if btnp(5) then
			game=0
		end
	end
end

-->8
----------------
function draw_player()
	spr(48,px-4,py-4)
end
----------------
function draw_all()
	for t in all(s) do
		draw(t)
	end
end
----------------
function draw(t)
	if t.t==0 then
		spr(16,t.x-8,t.y-4)
		spr(17,t.x,t.y-4)
		spr(32+t.p*4,t.x-4,t.y-4)
	elseif t.t==1 then
		pset(t.x,t.y,7)
	elseif t.t==2 then
		pset(t.x,t.y,6)
	end
end
----------------
function draw_game()
	?"time "..f,0,0,6
	draw_all()
	draw_player()
end
----------------
function draw_cover()
	?"timed space shooter",26,36,7
	?"press ‚ùé to begin",30,42,7
end
----------------
function draw_win()
	s="victory in "..stopped.." frames"
	?s,64-#s*2,36,7
end
----------------
function draw_loss()
	?"game over",46,36,7
end
----------------
function _draw()
	cls()
	if (game==0) draw_cover()
	if (game==1) draw_game()
	if (game==2) draw_win()
	if (game==3) draw_loss()
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0dddddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c11111111111111c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c11111111111111c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c111111111111c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00c1111111111c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000cc111111cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000cccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0006600000e00e0008000080bb0000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0006600000e00e000800008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00059500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00059500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0059a950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0059a950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
059aaa95000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
058aaa85000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
