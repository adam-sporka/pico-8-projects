pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
last_y=0
last_c=7
function ctr(s,y,c,w)
	x=64-(#s+(w or 0))*2
	print(s,x,y or last_y,c or last_c)
	last_y=(y or last_y)+6
	last_c=c or last_c
	return x
end 
--------
top=16
bottom=112
default_y=64
initial_energy=100
max_emitors=8
granularity=6
--------
screen=0
frame=0
top_hit=0
bottom_hit=0
--------
emitors={}
shots={}
y=default_y
score=0
energy=initial_energy
--------
function reset()
	emitors={}
	shots={}
	y=default_y
	score=0
	energy=initial_energy
end
--------
function add_shot(_x,_y,_d)
	add(shots,{
		x=_x,y=_y,d=_d,
		sfx(2,3),
		draw=function(self)
			pset(self.x,self.y,8)
		end,
		update=function(self)
			self.y=self.y+self.d*.5
			for e in all(emitors) do
				if self.y==e.y and
					self.x>=e.x1 and
					self.x<=e.x2 then
						--score
						del(shots,self)
						score+=1
						e.shots-=1
						sfx(3,1)
					end
			end
			if self.y<=top or self.y>=bottom then
				--energy
				sfx(4,2)
				energy-=1
				del(shots,self)
				if self.y<=top then top_hit=3 end
				if self.y>=bottom then bottom_hit=3 end
			end
		end
	})
end
--------
function add_emitor(_x1,_x2,_y)
	add(emitors,{
		--launch
		sfx(0,0),
		x1=_x1,
		x2=_x2,
		y=_y,
		last=frame,
		next=30,
		shots=15,
		draw=function(self)
			clr=5
			if self.shots<=3 then clr=2 end
			line(self.x1,self.y,self.x2,self.y,clr)
		end,
		update=function(self)
			if self.shots<0 then
				--cease
				del(emitors,self)
				sfx(1,0)
				return
			end
			if	frame-self.last>self.next then
				self.last=frame
				self.next=10+rnd(30)
				d=1
				if rnd(2)>1 then d=-1 end
				add_shot(flr(rnd(self.x2-self.x1)+self.x1),self.y,d)
			end
		end
	})
end
--------
c=0 l=0 y=-1
function new_current()
	c=flr(64)
	l=flr(rnd(32))+4
end
--------
function draw_current()
	clr=flr((frame/15)%2)+6
	line(c-l,y,c+l,y,clr)
end
--------
function draw_borders()
	rectfill(0,16,127,112,1)
	for x=0,127,8 do
		spr(2,x,0)
		spr(2,x,8)
		spr(2,x,112)
		spr(2,x,120)
	end
	ct=5
	if top_hit>0 then ct=8 end
	line(0,16,127,16,ct)
	ct=5
	if bottom_hit>0 then ct=8 end
	line(0,112,127,112,ct)
end
--------
function draw_score()
 for a=0,max_emitors-1 do
 	s=6
 	if #emitors<=a then s=3
 	end
 	spr(s,64+a*8-max_emitors*4,2)
 end
 rectfill(12,11,12+102,13,6)
 line(13,12,13+100,12,0)
 line(13,12,13+energy,12,7)
	score_lbl="score "..score
	ctr(score_lbl,118,7)
end
--------
function launch()
	for e in all(emitors) do
		if y==e.y then
			return
		end
	end
	if #emitors>=max_emitors then
		return
	end
	add_emitor(c-l,c+l,y)
	new_current()
end
--------
function draw_title()
	last_c=8
	last_y=23
	ctr("emit!")	
	last_y=35
	last_c=6
	ctr("how to play:")
	ctr("horizontal bars emit and")
	ctr("absorb particles.")
	last_y=60
	ctr("1 particle caught = +1 score ")
	ctr("top or bottom hit = -1 energy")
	last_y=78
	ctr("controls:")
	ctr("‚¨ÜÔ∏è‚¨áÔ∏è move cursor ",nil,nil,2)
	ctr("  üÖæÔ∏è place emitor",nil,nil,1)	
	last_c=8
	last_y=102
	ctr("press üÖæÔ∏è to start")
end
--------
function draw_gameover()
	ctr("game over",64,7)	
end
--------
function _draw()
	cls()
	draw_borders()
	for e in all(emitors) do	e:draw() end
	for s in all(shots) do s:draw() end
	if screen==0 then draw_title()
	elseif screen==1 then draw_current()
	elseif screen==2 then draw_gameover()
	end
	draw_score()
end
-------
function clamp(x,mn,mx)
	if x<mn then x=mn
	elseif x>mx then x=mx
	end
	return x
end
--------
function update_title()
	if btnp(4) then
		screen=1
	end
end
--------
function update_game()
	if energy<=0 then
		sfx(5,1)
		screen=2
		return
	end
	frame=frame+1
	top_hit-=1
	bottom_hit-=1
	for e in all(emitors) do e:update() end
	for s in all(shots) do s:update() end
	if btnp(2) then y-=granularity end
	if btnp(3) then y+=granularity end 
	y=clamp(y,top+granularity,bottom-granularity)
	if btnp(4) then launch() end
end
--------
function update_gameover()
	if btnp(5) then
		reset()
		screen=0
	end
end
--------
function _update()
	if screen==0 then
		update_title()
	elseif screen==1 then
		update_game()
	elseif screen==2 then
		update_gameover()
	end

end
--------
function _init()
	reset()
	new_current()
end

__gfx__
00000000000000000005000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000050005066666660666666606666666066666660666666600000000000000000000000000000000000000000000000000000000000000000
00700700000000000500050063333360688988606888886068888860688888600000000000000000000000000000000000000000000000000000000000000000
000770009a9a9a9a5000500063333360689998606889886068888860688888600000000000000000000000000000000000000000000000000000000000000000
00077000a9a9a9a90005000563333360699999606899986068898860688888600000000000000000000000000000000000000000000000000000000000000000
00700700000000000050005063333360689998606889886068888860688888600000000000000000000000000000000000000000000000000000000000000000
00000000000000000500050063333360688988606888886068888860688888600000000000000000000000000000000000000000000000000000000000000000
00000000000000005000500066666660666666606666666066666660666666600000000000000000000000000000000000000000000000000000000000000000
__label__
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888eeeeee888888888888888888888888888888888888888888888888888888888888888888888888ff8ff8888228822888222822888888822888888228888
8888ee888ee88888888888888888888888888888888888888888888888888888888888888888888888ff888ff888222222888222822888882282888888222888
888eee8e8ee88888e88888888888888888888888888888888888888888888888888888888888888888ff888ff888282282888222888888228882888888288888
888eee8e8ee8888eee8888888888888888888888888888888888888888888888888888888888888888ff888ff888222222888888222888228882888822288888
888eee8e8ee88888e88888888888888888888888888888888888888888888888888888888888888888ff888ff888822228888228222888882282888222288888
888eee888ee888888888888888888888888888888888888888888888888888888888888888888888888ff8ff8888828828888228222888888822888222888888
888eeeeeeee888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5ddd5ddd5ddd5ddd5ddd5ddd5ddd5ddd555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5e5e5ee555ee5eee5eee55ee5ee5555556655666566656565555566656665666565556665575557555555555555555555555555555555555555555555555
5e555e5e5e5e5e5555e555e55e5e5e5e555556565656565656565555556555655565565556555755555755555555555555555555555555555555555555555555
5ee55e5e5e5e5e5555e555e55e5e5e5e555556565665566656565555556555655565565556655755555755555555555555555555555555555555555555555555
5e555e5e5e5e5e5555e555e55e5e5e5e555556565656565656665555556555655565565556555755555755555555555555555555555555555555555555555555
5e5555ee5e5e55ee55e55eee5ee55e5e555556665656565656665666556556665565566656665575557555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666556656665555556655555ccc55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555656565555655555565557775c5c55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666566655655555565555555ccc55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555656555655655555565557775c5c55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556665656566555655666556655555ccc55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666556656665555565655555ccc5ccc5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555655565656555565555556565777555c555c5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666566655655555566655555ccc55cc5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555656555655655555555657775c55555c5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556665656566555655666566655555ccc5ccc5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555665666566655755c5c5ccc5ccc5ccc5ccc55c55c5c55755555555555555555555555555555555555555555555555555555555555555555555555555555
555556555565565657555c5c5c555ccc55c555c555c55c5c55575555555555555555555555555555555555555555555555555555555555555555555555555555
5555565555655665575555555cc55c5c55c555c555c5555555575555555555555555555555555555555555555555555555555555555555555555555555555555
5555565555655656575555555c555c5c55c555c55555555555575555555555555555555555555555555555555555555555555555555555555555555555555555
5555556655655656557555555ccc5c5c5ccc55c555c5555555755555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555558888855555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666556656665555565655555ccc5ccc8888855555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555655565656555565555556565777555c5c558888855555555555555555555555555555555555555555555555555555555555555555555555555555555555
5555565556665666556555555666555555cc5ccc8888855555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555655565655565565555555565777555c555c8888855555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556665656566555655666566655555ccc5ccc8888855555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666556656665555556655555c5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555656565555655555565557775c5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666566655655555565555555ccc55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555656555655655555565557775c5c55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556665656566555655666556655555ccc55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555665666566655755c5c5c5c55cc5c5c55555ccc55cc55555ccc5c555ccc5c5c55555c5c5575555555555555555555555555555555555555555555555555
555556555565565657555c5c5c5c5c5c5c5c555555c55c5c55555c5c5c555c5c5c5c55c55c5c5557555555555555555555555555555555555555555555555555
5555565555655665575555555ccc5c5c5c5c555555c55c5c55555ccc5c555ccc5ccc555555555557555555555555555555555555555555555555555555555555
5555565555655656575555555c5c5c5c5ccc555555c55c5c55555c555c555c5c555c55c555555557555555555555555555555555555555555555555555555555
5555556655655656557555555c5c5cc55ccc555555c55cc555555c555ccc5c5c5ccc555555555575555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555665666566655755c5c5c5c55cc5ccc5ccc5ccc55cc5cc55ccc5ccc5c5555555ccc5ccc5ccc55cc55555ccc5ccc5ccc5ccc55555ccc5cc55cc55c5c5575
555556555565565657555c5c5c5c5c5c5c5c55c5555c5c5c5c5c55c55c5c5c5555555c5c5c5c5c5c5c5555555c555ccc55c555c555555c5c5c5c5c5c5c5c5557
5555565555655665575555555ccc5c5c5cc555c555c55c5c5c5c55c55ccc5c5555555cc55ccc5cc55ccc55555cc55c5c55c555c555555ccc5c5c5c5c55555557
5555565555655656575555555c5c5c5c5c5c55c55c555c5c5c5c55c55c5c5c5555555c5c5c5c5c5c555c55555c555c5c55c555c555555c5c5c5c5c5c55555557
5555556655655656557555555c5c5cc55c5c5ccc5ccc5cc55c5c55c55c5c5ccc55555ccc5c5c5c5c5cc555555ccc5c5c5ccc55c555555c5c5c5c5ccc55555575
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555665666566655755c5c5ccc5ccc55cc55cc5ccc5ccc55555ccc5ccc5ccc5ccc5ccc55cc5c555ccc55cc55555c5c55755555555555555555555555555555
555556555565565657555c5c5c5c5c5c5c555c5c5c5c5c5c55555c5c5c5c5c5c55c555c55c555c555c555c5555555c5c55575555555555555555555555555555
5555565555655665575555555ccc5cc55ccc5c5c5cc55cc555555ccc5ccc5cc555c555c55c555c555cc55ccc5555555555575555555555555555555555555555
5555565555655656575555555c5c5c5c555c5c5c5c5c5c5c55555c555c5c5c5c55c555c55c555c555c55555c5555555555575555555555555555555555555555
5555556655655656557555555c5c5ccc5cc55cc55c5c5ccc55555c555c5c5c5c55c55ccc55cc5ccc5ccc5cc555c5555555755555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666556656665555565655555c555ccc5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555656565555655555565657775c555c5c5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666566655655555566655555ccc5c5c5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555656555655655555555657775c5c5c5c5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556665656566555655666566655555ccc5ccc5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555665666566655755c5c55555cc555555ccc55cc5ccc5cc55ccc5555555555555cc555555ccc5ccc5ccc5ccc5ccc55cc5c555ccc555555cc5ccc5c5c55cc
555556555565565657555c5c55c555c555555c5c5c5c55c55c5c55c555555ccc555555c555555c5c5c5c5c5c55c555c55c555c555c5555555c555c5c5c5c5c55
5555565555655665575555555ccc55c555555ccc5c5c55c55c5c55c555555555555555c555555ccc5ccc5cc555c555c55c555c555cc555555c555ccc5c5c5c55
55555655556556565755555555c555c555555c555c5c55c55c5c55c555555ccc555555c555555c555c5c5c5c55c555c55c555c555c5555555c555c5c5c5c5c5c
55555566556556565575555555555ccc55555c555cc55ccc5c5c55c55555555555555ccc55555c555c5c5c5c55c55ccc55cc5ccc5ccc555555cc5c5c55cc5ccc
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555665666566655755c5c55555cc555555ccc5cc55ccc5ccc55cc5c5c5555555555555ccc55cc5ccc555555cc5ccc55555ccc55cc5ccc5ccc55cc5ccc5555
555556555565565657555c5c555555c555555c555c5c5c555c5c5c555c5c55555ccc555555c55c5c5c5c55555c5c5c5c55555c5c5c5c55c555c55c5c5ccc5555
5555565555655665575555555ccc55c555555cc55c5c5cc55cc55c555ccc55555555555555c55c5c5ccc55555c5c5cc555555cc55c5c55c555c55c5c5c5c5555
555556555565565657555555555555c555555c555c5c5c555c5c5c5c555c55555ccc555555c55c5c5c5555555c5c5c5c55555c5c5c5c55c555c55c5c5c5c5555
55555566556556565575555555555ccc55555ccc5c5c5ccc5c5c5ccc5ccc55555555555555c55cc55c5555555cc55c5c55555ccc5cc555c555c55cc55c5c5555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666556656665555565655555ccc5ccc5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555655565656555565555556565777555c5c5c5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555655566656665565555556665555555c5ccc5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555655565655565565555555565777555c5c5c5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555666565656655565566656665555555c5ccc5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555665666566655755c5c55cc55cc5cc55ccc5ccc55cc5c5555cc55555c5c5575555555555555555555555555555555555555555555555555555555555555
555556555565565657555c5c5c555c5c5c5c55c55c5c5c5c5c555c5555c55c5c5557555555555555555555555555555555555555555555555555555555555555
5555565555655665575555555c555c5c5c5c55c55cc55c5c5c555ccc555555555557555555555555555555555555555555555555555555555555555555555555
5555565555655656575555555c555c5c5c5c55c55c5c5c5c5c55555c55c555555557555555555555555555555555555555555555555555555555555555555555
55555566556556565575555555cc5cc55c5c55c55c5c5cc55ccc5cc5555555555575555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555665666566655755c5c55ccccc555ccccc555555ccc55cc5c5c5ccc555555cc5c5c5ccc55cc55cc5ccc55555c5c55555cc55ccc5c5555555cc55ccc5c55
555556555565565657555c5c5ccc5ccc5cc555cc55555ccc5c5c5c5c5c5555555c555c5c5c5c5c555c5c5c5c55555c5c55555c5c55c55c5555555c5c55c55c55
5555565555655665575555555cc555cc5cc555cc55555c5c5c5c5c5c5cc555555c555c5c5cc55ccc5c5c5cc55555555555555c5c55c55c5555555c5c55c55c55
5555565555655656575555555cc555cc5ccc5ccc55555c5c5c5c5ccc5c5555555c555c5c5c5c555c5c5c5c5c5555555555755c5c55c55c5555755c5c55c55c55
55555566556556565575555555ccccc555ccccc555555c5c5cc555c55ccc555555cc55cc5c5c5cc55cc55c5c5555555557555c5c5ccc5ccc57555c5c5ccc5ccc
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555665666566655755c5c5555555555ccccc555555ccc5c555ccc55cc5ccc55555ccc5ccc5ccc5ccc55cc5ccc5c5c55555cc55ccc5c5555555cc55ccc5c55
555556555565565657555c5c555555555cc555cc55555c5c5c555c5c5c555c5555555c555ccc55c555c55c5c5c5c5c5c55555c5c55c55c5555555c5c55c55c55
555556555565566557555555555555555cc5c5cc55555ccc5c555ccc5c555cc555555cc55c5c55c555c55c5c5cc5555555555c5c55c55c5555555c5c55c55c55
555556555565565657555555555555555cc555cc55555c555c555c5c5c555c5555555c555c5c55c555c55c5c5c5c555555755c5c55c55c5555755c5c55c55c55
5555556655655656557555555555555555ccccc555555c555ccc5c5c55cc5ccc55555ccc5c5c5ccc55c55cc55c5c555557555c5c5ccc5ccc57555c5c5ccc5ccc
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666556656665555556655555ccc55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555656565555655555565557775c5c55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666566655655555565555555ccc55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555656555655655555565557775c5c55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556665656566555655666556655555ccc55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556555666556656665555565655555cc55ccc5ccc555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5555565556565655556555555656577755c55c5c555c555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5555565556665666556555555666555555c55c5c5ccc555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5555565556565556556555555556577755c55c5c5c55555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555556665656566555655666566655555ccc5ccc5ccc555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555515555555555555555555555555555555555555555555555555555555555
88888888888888888888888888888888888888888888888888888888888888888888171888888888888888888888888888888888888888888888888888888888
8fff88ff8f8f8fff8ff8888888ff88ff8f8f8ff88fff888888888888888888888888177188888888888888888222822282288882822282288222822288866688
88f88f8f8f8f8f888f8f88888f888f8f8f8f8f8f88f8888888888888888888888888177718888888888888888282888288288828828288288282888288888888
88f88f8f8ff88ff88f8f88888f888f8f8f8f8f8f88f8888888888888888888888888177771888888888888888222882288288828822288288222822288822288
88f88f8f8f8f8f888f8f88888f888f8f8f8f8f8f88f8888888888888888888888888177118888888888888888282888288288828828288288882828888888888
88f88ff88f8f8fff8f8f888888ff8ff888ff8f8f88f8888888888888888888888888811718888888888888888222822282228288822282228882822288822288
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888

__sfx__
010800001104013030150201701000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010800001a04018030160201401000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010100000c61000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010100003051000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010800000805007040060300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
